<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ledger.</title>
<style>
  :root{
    --bg:#0b0b0c;
    --text:#e9eaec;
    --muted:#a6a6ac;
    --bubble:#a53731;          /* bot (red) */
    --bubbleText:#fff3f3;
    --pill:#2b2a2b;            /* input pill + user bubble */
    --pillBorder:rgba(255,255,255,.06);
    --arrow:#c9cbd2;
    --shadow:0 8px 22px rgba(0,0,0,.35);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font:15px/1.45 "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  .wrap{height:100%; position:relative; overflow:hidden}

  /* ===== Header ===== */
  .brand-wrap{
    position:fixed; top:18px; left:22px; right:22px;
    z-index:5; user-select:none;
  }
  .brand{ font-weight:400; font-size:28px; letter-spacing:.1px }
  .brand-line{ margin-top:6px; height:1px; width:100%; background:rgba(255,255,255,.18) }

  main{height:100%; display:block; padding:20px}

  /* ===== Messages area ===== */
  .log{
    position:absolute; left:22px; right:22px; top:106px; bottom:160px;
    overflow:auto; display:flex; flex-direction:column; gap:14px; padding-right:2px;
  }
  .msg{
    max-width:420px;
    padding:7px 11px;
    border-radius:14px;
    box-shadow:var(--shadow);
    font-weight:400; font-size:13.5px;
    white-space:pre-wrap; word-wrap:break-word;
  }
  .msg.bot{
    align-self:flex-start;
    background:var(--bubble);
    color:var(--bubbleText);
  }
  .msg.me{
    align-self:flex-end;
    background:var(--pill);     /* same color as input pill */
    color:var(--text);
    border:1px solid var(--pillBorder);
  }

  /* ===== Composer (smaller) ===== */
  .composer{
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:86px;
    width:min(560px, 84vw);
    background:var(--pill);
    border:1px solid var(--pillBorder);
    border-radius:999px;
    padding:6px 10px;
    box-shadow:var(--shadow);
    display:flex; align-items:center; gap:8px;
  }
  .composer input{
    flex:1; background:transparent; border:none; outline:none; color:var(--text);
    font:14px "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  .composer input::placeholder{ color:var(--muted) }

  /* ===== Larger arrow-in-circle send ===== */
  .send{
    width:40px; height:40px; border-radius:50%;
    border:1px solid rgba(255,255,255,.10);
    background:#3a393a;
    display:grid; place-items:center;
    cursor:pointer;
  }
  .send svg{ width:22px; height:22px }
  .send path{
    fill:none; stroke:var(--arrow); stroke-width:2.4;
    stroke-linecap:round; stroke-linejoin:round;
  }
  .send:disabled{ opacity:.6; cursor:not-allowed }

  @media (max-width:640px){
    .brand-wrap{ top:14px; left:14px; right:14px }
    .brand{ font-size:28px }
    .log{ top:96px; left:14px; right:14px; bottom:140px }
    .composer{ bottom:64px; width:90vw }
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <div class="brand-wrap">
      <div class="brand">Ledger.</div>
      <div class="brand-line"></div>
    </div>

    <main aria-label="Chat canvas">
      <!-- messages appear here -->
      <div class="log" id="log"></div>

      <!-- composer -->
      <form class="composer" id="composer">
        <input id="q" type="text" placeholder="Ask anything â€¦" autocomplete="off" />
        <button class="send" id="send" type="submit" aria-label="Send">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 17 V7 M8.5 10.5 L12 7 L15.5 10.5" />
          </svg>
        </button>
      </form>
    </main>
  </div>

<script>
  const API_BASE = "";
  const CHAT_URL = API_BASE ? `${API_BASE}/chat` : null;

  const form   = document.getElementById('composer');
  const q      = document.getElementById('q');
  const log    = document.getElementById('log');
  const sendBtn= document.getElementById('send');

  // Append a bubble
  function addBubble(text, who='bot'){
    const div = document.createElement('div');
    div.className = `msg ${who}`;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
    return div;
  }

  // Typewriter effect for bot messages
  function typeWriterBubble(text, who='bot'){
    const div = addBubble("", who);
    let i = 0;
    function type(){
      if (i < text.length){
        div.textContent += text.charAt(i++);
        log.scrollTop = log.scrollHeight;
        setTimeout(type, 35);
      }
    }
    type();
  }

  // Initial greeting
  window.addEventListener('DOMContentLoaded', ()=>{
    typeWriterBubble("Hi! How can I help today?", 'bot');
  });

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const text = q.value.trim();
    if (!text) return;
    q.value = ""; q.focus(); sendBtn.disabled = true;

    // user bubble
    addBubble(text, 'me');

    if (!CHAT_URL){
      await new Promise(r=>setTimeout(r,600));
      typeWriterBubble("ðŸ”§ API not connected yet. This is a mock response.", 'bot');
      sendBtn.disabled = false; 
      return;
    }

    try{
      const r = await fetch(CHAT_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ message: text })
      });
      const data = await r.json();
      typeWriterBubble(data?.reply || 'â€¦', 'bot');
    }catch{
      typeWriterBubble("Oopsâ€”server error. Try again.", 'bot');
    }finally{
      sendBtn.disabled = false;
    }
  });
</script>
</body>
</html>

